<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <title>Calculator</title>
</head>
<body>
    <div id="calculator-body">
        <div id="screen">
            <div id="expression">
                <p id="operand-left"></p>
                <img src="" id="operator">
                <p id="operand-right"></p>
                <p id="cursor">|</p>
            </div>
            <p id="answer"></p>
        </div>
        <div id="keys">
            <div id="key-row-1" class="key-row">
                <button id="seven">7</button>
                <button id="eight">8</button>
                <button id="nine">9</button>
                <button id="add"><img src="./img/add.svg" id="add-img"></button>
            </div>
            <div id="key-row-2" class="key-row">
                <button id="four">4</button>
                <button id="five">5</button>
                <button id="six">6</button>
                <button id="subtract"><img src="./img/subtract.svg" id="subtract-img"></button>
            </div>
            <div id="key-row-3" class="key-row">
                <button id="one">1</button>
                <button id="two">2</button>
                <button id="three">3</button>
                <button id="multiply"><img src="./img/multiply.svg" id="multiply-img"></button>
            </div>
            <div id="key-row-4" class="key-row">
                <button id="zero">0</button>
                <button id="dot"><img src="./img/dot.svg" id="dot-img"></button>
                <button id="neg"><img src="./img/negative-symbol.svg" id="negative-symbol-img"></button>
                <button id="divide"><img src="./img/divide.svg" id="divide-img"></button>
            </div>
            <div id="key-row-5" class="key-row">
                <button id="del">DEL</button>
                <button id="equal">=</button>
            </div>
        </div>
    </div>
    <script>
        let operandStore = '';
        let currOperand = '';
        let operator = '';
        let answer = ''

        //add event listeners for all buttons
        for(let i = 1; i <=5; i++) {
            let id = "#key-row-" + i + " button";
            let row = document.querySelectorAll(id);
            row.forEach((button) => {
                button.addEventListener("click", () => {
                    operandNumberOrFunc(button.id);
                    console.log(button.id);
                });
            });
        }
      
        function updateScreen() {
            let operandLeft = document.querySelector("#screen #expression #operand-left");
            let operandRight = document.querySelector("#screen #expression #operand-right");
            let operatorSVG = document.querySelector("#screen #expression #operator");
            let screenAnswer = document.querySelector("#screen #answer");
            let empty = '';
            operandLeft.textContent = empty;
            operandRight.textContent = empty;
            screenAnswer.textContent = empty;
            operatorSVG.setAttribute("src", "");
            operatorSVG.style.margin = 0;
            if(operator != '') {
                let operatorSVGPath = "./img/expression-" + operator + ".svg";
                operatorSVG.style.margin = "0px 5px";
            }
            let operatorSVGPath = "./img/expression-" + operator + ".svg";
            if(currOperand != empty && operandStore == empty && operator == empty && answer == empty) {
                operandLeft.textContent = currOperand;
            }
            else if(currOperand != empty && operandStore == empty && operator == empty && answer != empty) {
                operandLeft.textContent = currOperand;
                screenAnswer.textContent = answer;
            }
            else if(currOperand == empty && operandStore != empty && operator != empty && answer == empty) {
                operandLeft.textContent = operandStore;
                operatorSVG.setAttribute("src", operatorSVGPath);
            }
            else if(currOperand != empty && operandStore != empty && operator != empty && answer == empty) {
                operandLeft.textContent = operandStore;
                operandRight.textContent = currOperand;
                operatorSVG.setAttribute("src", operatorSVGPath);
            }
            else if(currOperand != empty && operandStore != empty && operator != empty && answer != empty) {
                operandLeft.textContent = operandStore;
                operandRight.textContent = currOperand;
                operatorSVG.setAttribute("src", operatorSVGPath);
                screenAnswer.textContent = answer;
            }
            //if everything but the answer is empty, this is an error message 
            else if(currOperand == empty && operandStore == empty && operator == empty && answer != empty) {
                screenAnswer.textContent = answer;
            }
        }

        function operate(operator, operand1, operand2) {
            console.log("Operating on " + operand1 + " " + operator + " " + operand2);
            if(operator == "add") { 
                return operand1 + operand2;
            }
            else if(operator == "subtract") {
                return operand1 - operand2;
            }
            else if(operator == "multiply") {
                return operand1 * operand2;
            }
            else if(operator == "divide") {
                return operand1 / operand2;
            }
        }

        function operandNumberOrFunc(id) {
            let number = '';
            switch(id) {
                case "zero":
                    number += 0;
                    break;
                case "one":
                    number += 1;
                    console.log(currOperand);
                    break;
                case "two":
                    number += 2;
                    break;
                case "three":
                    number += 3;
                    break;
                case "four":
                    number += 4;
                    break;
                case "five":
                    number += 5;
                    break;
                case "six":
                    number += 6;
                    break;
                case "seven":
                    number += 7;
                    break;
                case "eight":
                    number += 8;
                    break;
                case "nine":
                    number += 9;
                    break;
                case "add":
                case "subtract":
                case "multiply":
                case "divide":
                    //if there is only one operand 
                    if(currOperand != '' && operandStore == '' && operator == '' && answer == '') {
                        operandStore = currOperand;
                        currOperand = '';
                        operator = id;
                    }
                    //if back to back operators, swap operator
                    else if(operandStore != '' && currOperand == '' && operator != '' && answer == '') {
                        operator = id;
                    }
                    //if there is a current expression that hasn't been evaluated yet
                    else if(operandStore != '' && currOperand != '' && operator != '' && answer == '') {

                        if(divideByZero(currOperand, operator)) {
                            operandStore = '';
                            currOperand = '';
                            operator = ''
                            answer = "You cannot divide by zero!";
                            console.log("divide by zero error!");
                        }
                        else {
                            operandStore = (operate(operator, Number(operandStore), Number(currOperand)));
                            console.log(operandStore);
                            currOperand = '';
                            operator = id;
                        }
                    }
                    else if(operandStore != '' && currOperand != '' && operator != '' && answer != '') {
                        operandStore = (operate(operator, Number(operandStore), Number(currOperand)));
                        console.log(operandStore);
                        currOperand = '';
                        operator = id;
                        answer = '';
                    }
                    break;
                case "equal":
                    if(operandStore == '' && currOperand != '' && operator == '' && answer == '') {
                        answer = currOperand;
                    }
                    if(operandStore != '' && currOperand != '' && operator != '') {
                        if(divideByZero(currOperand, operator)) {
                            operandStore = '';
                            currOperand = '';
                            operator = ''
                            answer = "You cannot divide by zero!";
                            console.log("divide by zero error!");
                        }
                        else {
                            answer = (operate(operator, Number(operandStore), Number(currOperand)));
                            console.log(answer);
                        }
                    }
                    break;
                case "del":
                    operandStore = '';
                    currOperand = '';
                    operator = ''
                    answer = '';
                    break;
            }

            if(number != '' && answer == '') {
                currOperand += number;
            }
            else if(number != '' && answer != '') {
                currOperand = number;
                operandStore = '';
                operator = '';
                answer = '';
            }
        
            updateScreen();
        }

        function divideByZero(operand, operator) {
            if(operand == '0' && operator == 'divide') {
                return true;
            }
            else {
                return false;
            }
        }

        //blinking
        setInterval(() => {
            let cursor = document.querySelector("#screen #cursor");
            if(cursor.textContent == "|") {
                cursor.textContent = "";
            }
            else {
                cursor.textContent = "|";
            }
        }, 500);
    </script>
</body>
</html>